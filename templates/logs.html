{% include 'includes/head.html' %}
<body>
    <div class="container-fluid">
        <main>
            {% include 'includes/nav.html' %}
        <h1>Live Logs</h1>

        <div class="log-controls mb-3 d-flex gap-2 align-items-center flex-wrap">
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="auto-refresh" checked>
                <label class="form-check-label" for="auto-refresh">Auto-refresh (5s)</label>
            </div>
            <div>
                <label for="line-count" class="form-label me-2 mb-0">Lines:</label>
                <select id="line-count" class="form-select form-select-sm d-inline-block w-auto">
                    <option value="50">50</option>
                    <option value="100" selected>100</option>
                    <option value="200">200</option>
                    <option value="500">500</option>
                </select>
            </div>
            <button onclick="loadLogs()" class="btn btn-primary btn-sm">Refresh Now</button>
            <span id="status" class="auto-refresh-status text-muted ms-2"></span>
        </div>

        <div id="log-container" class="log-container">Loading logs...</div>
        </main>
    </div>

    <script>
        let autoRefreshInterval = null;

        function loadLogs() {
            const lines = document.getElementById('line-count').value;
            const status = document.getElementById('status');
            
            status.textContent = 'Loading...';
            
            fetch(`/api/logs?lines=${lines}`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('log-container');
                    if (data.success) {
                        container.textContent = data.logs || 'No logs available.';
                        // Auto-scroll to bottom
                        container.scrollTop = container.scrollHeight;
                        status.textContent = `✓ ${data.line_count} lines`;
                    } else {
                        container.textContent = `Error: ${data.error}`;
                        status.textContent = '✗ Error';
                    }
                })
                .catch(error => {
                    document.getElementById('log-container').textContent = `Error loading logs: ${error}`;
                    status.textContent = '✗ Failed';
                });
        }

        function toggleAutoRefresh() {
            const checkbox = document.getElementById('auto-refresh');
            
            if (checkbox.checked) {
                // Start auto-refresh every 5 seconds
                loadLogs();
                autoRefreshInterval = setInterval(loadLogs, 5000);
            } else {
                // Stop auto-refresh
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
            }
        }

        // Initialize
        document.getElementById('auto-refresh').addEventListener('change', toggleAutoRefresh);
        document.getElementById('line-count').addEventListener('change', loadLogs);

        // Start auto-refresh on page load
        toggleAutoRefresh();
    </script>
</body>
</html>
